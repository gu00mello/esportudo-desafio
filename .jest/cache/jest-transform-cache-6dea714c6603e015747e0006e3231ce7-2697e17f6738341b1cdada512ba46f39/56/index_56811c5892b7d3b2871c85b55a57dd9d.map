{"version":3,"names":["require","readFileSync","dotenv","parseDotenvFile","path","verbose","content","error","console","parse","module","exports","t","types","name","pre","opts","envName","moduleName","whitelist","blacklist","allowlist","blocklist","safe","allowUndefined","babelMode","process","env","log","parsed","localParsed","modeParsed","modeLocalParsed","Object","assign","NODE_ENV","config","silent","visitor","ImportDeclaration","node","source","value","specifiers","entries","idx","specifier","type","get","buildCodeFrameError","imported","local","importedId","localId","Array","isArray","includes","warn","prototype","hasOwnProperty","call","binding","scope","getBinding","refPath","referencePaths","replaceWith","valueToNode","remove","MemberExpression","matchesPattern","key","toComputedKey","isStringLiteral"],"sources":["index.js"],"sourcesContent":["const {readFileSync} = require('fs')\r\nconst dotenv = require('dotenv')\r\n\r\nfunction parseDotenvFile(path, verbose = false) {\r\n  let content\r\n\r\n  try {\r\n    content = readFileSync(path)\r\n  } catch (error) {\r\n    // The env file does not exist.\r\n    if (verbose) {\r\n      console.error('react-native-dotenv', error)\r\n    }\r\n\r\n    return {}\r\n  }\r\n\r\n  return dotenv.parse(content)\r\n}\r\n\r\nmodule.exports = ({types: t}) => ({\r\n  name: 'dotenv-import',\r\n\r\n  pre() {\r\n    this.opts = {\r\n      envName: 'APP_ENV',\r\n      moduleName: '@env',\r\n      path: '.env',\r\n      whitelist: null,\r\n      blacklist: null,\r\n      allowlist: null,\r\n      blocklist: null,\r\n      safe: false,\r\n      allowUndefined: true,\r\n      verbose: false,\r\n      ...this.opts,\r\n    }\r\n\r\n    const babelMode = process.env[this.opts.envName] || (process.env.BABEL_ENV && process.env.BABEL_ENV !== 'undefined' && process.env.BABEL_ENV !== 'development' && process.env.BABEL_ENV) || process.env.NODE_ENV || 'development'\r\n    if (this.opts.verbose) {\r\n      console.log('dotenvMode', babelMode)\r\n    }\r\n\r\n    if (this.opts.safe) {\r\n      const parsed = parseDotenvFile(this.opts.path, this.opts.verbose)\r\n      const localParsed = parseDotenvFile(this.opts.path + '.local')\r\n      const modeParsed = parseDotenvFile(this.opts.path + '.' + babelMode)\r\n      const modeLocalParsed = parseDotenvFile(this.opts.path + '.' + babelMode + '.local')\r\n      this.env = Object.assign(Object.assign(Object.assign(parsed, modeParsed), localParsed), modeLocalParsed)\r\n      this.env.NODE_ENV = process.env.NODE_ENV || babelMode\r\n    } else {\r\n      dotenv.config({\r\n        path: this.opts.path + '.' + babelMode + '.local',\r\n        silent: true,\r\n      })\r\n      dotenv.config({\r\n        path: this.opts.path + '.' + babelMode,\r\n        silent: true,\r\n      })\r\n      dotenv.config({\r\n        path: this.opts.path + '.local',\r\n        silent: true,\r\n      })\r\n      dotenv.config({\r\n        path: this.opts.path,\r\n      })\r\n      this.env = process.env\r\n    }\r\n  },\r\n\r\n  visitor: {\r\n    ImportDeclaration(path, {opts}) {\r\n      if (path.node.source.value === opts.moduleName) {\r\n        for (const [idx, specifier] of path.node.specifiers.entries()) {\r\n          if (specifier.type === 'ImportDefaultSpecifier') {\r\n            throw path.get('specifiers')[idx].buildCodeFrameError('Default import is not supported')\r\n          }\r\n\r\n          if (specifier.type === 'ImportNamespaceSpecifier') {\r\n            throw path.get('specifiers')[idx].buildCodeFrameError('Wildcard import is not supported')\r\n          }\r\n\r\n          if (specifier.imported && specifier.local) {\r\n            const importedId = specifier.imported.name\r\n            const localId = specifier.local.name\r\n\r\n            if (Array.isArray(opts.allowlist) && !opts.allowlist.includes(importedId)) {\r\n              throw path.get('specifiers')[idx].buildCodeFrameError(`\"${importedId}\" was not present in allowlist`)\r\n            } else if (Array.isArray(opts.whitelist) && !opts.whitelist.includes(importedId)) {\r\n              console.warn('[DEPRECATION WARNING] This option is will be deprecated soon. Use allowlist instead')\r\n              throw path.get('specifiers')[idx].buildCodeFrameError(`\"${importedId}\" was not whitelisted`)\r\n            }\r\n\r\n            if (Array.isArray(opts.blocklist) && opts.blocklist.includes(importedId)) {\r\n              throw path.get('specifiers')[idx].buildCodeFrameError(`\"${importedId}\" was not present in blocklist`)\r\n            } else if (Array.isArray(opts.blacklist) && opts.blacklist.includes(importedId)) {\r\n              console.warn('[DEPRECATION WARNING] This option is will be deprecated soon. Use blocklist instead')\r\n              throw path.get('specifiers')[idx].buildCodeFrameError(`\"${importedId}\" was blacklisted`)\r\n            }\r\n\r\n            if (!opts.allowUndefined && !Object.prototype.hasOwnProperty.call(this.env, importedId)) {\r\n              throw path.get('specifiers')[idx].buildCodeFrameError(`\"${importedId}\" is not defined in ${opts.path}`)\r\n            }\r\n\r\n            const binding = path.scope.getBinding(localId)\r\n            for (const refPath of binding.referencePaths) {\r\n              refPath.replaceWith(t.valueToNode(this.env[importedId]))\r\n            }\r\n          }\r\n        }\r\n\r\n        path.remove()\r\n      }\r\n    },\r\n    MemberExpression(path, {opts}) {\r\n      if (path.get('object').matchesPattern('process.env')) {\r\n        const key = path.toComputedKey()\r\n        if (t.isStringLiteral(key)) {\r\n          const importedId = key.value\r\n          const value = (opts.env && importedId in opts.env) ? opts.env[importedId] : process.env[importedId]\r\n\r\n          path.replaceWith(t.valueToNode(value))\r\n        }\r\n      }\r\n    },\r\n  },\r\n})\r\n"],"mappings":"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"}